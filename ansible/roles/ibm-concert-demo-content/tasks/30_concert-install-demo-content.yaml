
# *************************************************************************************************************************************************
# --------------------------------------------------------------------------------------------------------------------------------------
# Install IBM Concert
# --------------------------------------------------------------------------------------------------------------------------------------
# *************************************************************************************************************************************************

# --------------------------------------------------------------------------------------------------------------------------------------
# Install IBM Concert Demo Content
# --------------------------------------------------------------------------------------------------------------------------------------

- name: üõ∞Ô∏è  START - INSTALL IBM Concert
  debug: 
    msg="{{ lookup('pipe','date +%d.%m.%Y---%H:%M:%S') }}"


- name: Log
  shell: |
    export MESSAGE="Installing IBM Concert Demo Content"
    export currentDate=$(date +%Y-%m-%d_%H:%M)
    echo "---------------------------------------------------------------------------------------------------------------------------------------------------" >> ../install_{{current_feature.kind}}.log
    echo $currentDate" - "$MESSAGE  >> ../install_{{current_feature.kind}}.log
  ignore_errors: true





- name: üöÄ IBM Concert - Set IBM Concert Password 
  set_fact: current_admin_pass={{global_config.global_password}}


- name: üü£  IBM Concert -  IBM Concert Password {{current_admin_pass}}
  debug:
    var: current_admin_pass
    verbosity: 1


- name:   üöÄ IBM Concert - Load Default Demo Content
  shell: |
    set -x


    echo ""
    echo ""
    echo ""
    echo ""
    echo "------------------------------------------------------------------------------------------------------------------------------"
    echo " üöÄ Set Variables"
    echo "------------------------------------------------------------------------------------------------------------------------------"
    export CONCERT_NAMESPACE=ibm-concert
    echo "       üõ†Ô∏è   Get Route"
    export ROUTE=$(oc get route -n $CONCERT_NAMESPACE cp-console  -o jsonpath={.spec.host})          
    echo "        Route: $ROUTE"
    echo ""
    export USER_PWD={{current_admin_pass}}
    export USER_NAME=demo
    export ACCESS_TOKEN=$(curl -s -k -H "Content-Type: application/x-www-form-urlencoded;charset=UTF-8" -d "grant_type=password&username=$USER_NAME&password=$USER_PWD&scope=openid" https://$ROUTE/idprovider/v1/auth/identitytoken|jq -r '.access_token')
    echo "        CPADMIN_USER: $USER_NAME"
    echo "        CPADMIN_PWD:  $USER_PWD"
    echo "        ACCESS_TOKEN: $ACCESS_TOKEN"

 
    echo "       üõ†Ô∏è   Getting ZEN Token"
  
    ZEN_API_HOST=$(oc get route -n $CONCERT_NAMESPACE concert -o jsonpath='{.spec.host}')

    ZEN_LOGIN_RESPONSE=$(curl -k -X "GET" "https://$ZEN_API_HOST/v1/preauth/validateAuth" \
    -H 'username: demo' \
    -H "iam-token: $ACCESS_TOKEN")

    ZEN_LOGIN_MESSAGE=$(echo "${ZEN_LOGIN_RESPONSE}" | jq -r .message)
    echo $ZEN_LOGIN_MESSAGE

    ZEN_TOKEN=$(echo "${ZEN_LOGIN_RESPONSE}" | jq -r .accessToken)
    echo "${ZEN_TOKEN}"
    echo "Sucessfully logged in" 1>&2
    echo ""
    echo ""
    echo ""
    echo ""
    echo ""
    echo "------------------------------------------------------------------------------------------------------------------------------"
    echo " üöÄ Load Default Demo Content"
    echo "------------------------------------------------------------------------------------------------------------------------------"
    curl -X "POST" -k "https://$ZEN_API_HOST/ibm/concert/ingestion/api/v1/load_sample_data" \
              -H "Authorization: Bearer $ZEN_TOKEN" \
              -H 'accept: application/json' \
              -H 'instanceId: 0000-0000-0000-0000' 

  register: output_string
  ignore_errors: true
  args:
    executable: /bin/bash

- name: üü£  OUTPUT
  debug: 
    var: output_string.stdout_lines
    #verbosity: 1


- name:   üöÄ IBM Concert - Demo Content Compliance
  shell: |
    set -x


    echo ""
    echo ""
    echo ""
    echo ""
    echo "------------------------------------------------------------------------------------------------------------------------------"
    echo " üöÄ Set Variables"
    echo "------------------------------------------------------------------------------------------------------------------------------"
    export CONCERT_NAMESPACE=ibm-concert
    echo "       üõ†Ô∏è   Get Route"
    export ROUTE=$(oc get route -n $CONCERT_NAMESPACE cp-console  -o jsonpath={.spec.host})          
    echo "        Route: $ROUTE"
    echo ""
    export USER_PWD={{current_admin_pass}}
    export USER_NAME=demo
    export ACCESS_TOKEN=$(curl -s -k -H "Content-Type: application/x-www-form-urlencoded;charset=UTF-8" -d "grant_type=password&username=$USER_NAME&password=$USER_PWD&scope=openid" https://$ROUTE/idprovider/v1/auth/identitytoken|jq -r '.access_token')
    echo "        CPADMIN_USER: $USER_NAME"
    echo "        CPADMIN_PWD:  $USER_PWD"
    echo "        ACCESS_TOKEN: $ACCESS_TOKEN"

 
    echo "       üõ†Ô∏è   Getting ZEN Token"
  
    ZEN_API_HOST=$(oc get route -n $CONCERT_NAMESPACE concert -o jsonpath='{.spec.host}')

    ZEN_LOGIN_RESPONSE=$(curl -k -X "GET" "https://$ZEN_API_HOST/v1/preauth/validateAuth" \
    -H 'username: demo' \
    -H "iam-token: $ACCESS_TOKEN")

    ZEN_LOGIN_MESSAGE=$(echo "${ZEN_LOGIN_RESPONSE}" | jq -r .message)
    echo $ZEN_LOGIN_MESSAGE

    ZEN_TOKEN=$(echo "${ZEN_LOGIN_RESPONSE}" | jq -r .accessToken)
    echo "${ZEN_TOKEN}"
    echo "Sucessfully logged in" 1>&2
    echo ""
    echo ""
    echo ""
    echo ""
    echo ""
    echo "------------------------------------------------------------------------------------------------------------------------------"
    echo " üöÄ Upload Compliance Catalog"
    echo "------------------------------------------------------------------------------------------------------------------------------"
    curl -X "POST" -k "https://$ZEN_API_HOST/ibm/concert/compliance/api/v1/import_catalogs" \
          -H "Authorization: Bearer $ZEN_TOKEN" \
          -H 'accept: application/json' \
          -H 'instanceId: 0000-0000-0000-0000' \
          -H 'Content-Type: multipart/form-data' \
          -F 'file=@./roles/ibm-concert-demo-content/templates/content/compliance/sample-compliance/NIST_SP-800-53_rev4_LOW-baseline-resolved-profile_catalog.json;type=application/json'

    echo ""
    echo ""
    echo ""
    echo ""
    echo ""
    echo "------------------------------------------------------------------------------------------------------------------------------"
    echo " üöÄ Upload Compliance Profile"
    echo "------------------------------------------------------------------------------------------------------------------------------"
    curl -X "POST" -k "https://$ZEN_API_HOST/ibm/concert/compliance/api/v1/import_profiles" \
          -H "Authorization: Bearer $ZEN_TOKEN" \
          -H 'accept: application/json' \
          -H 'instanceId: 0000-0000-0000-0000' \
          -H 'Content-Type: multipart/form-data' \
          -F 'file=@./roles/ibm-concert-demo-content/templates/content/compliance/sample-compliance/profileupload.json;type=application/json'

    echo ""
    echo ""
    echo ""
    echo ""
    echo ""
    echo "------------------------------------------------------------------------------------------------------------------------------"
    echo " üöÄ Upload Compliance Posture"
    echo "------------------------------------------------------------------------------------------------------------------------------"
    curl -X "POST" -k "https://$ZEN_API_HOST/ibm/concert/ingestion/api/v1/upload_files" \
        -H 'accept: application/json' \
        -H 'InstanceID: 0000-0000-0000-0000' \
        -H "Authorization: Bearer $ZEN_TOKEN" \
        -H 'Content-Type: multipart/form-data' \
        -F "data_type=compliance" \
        -F "filename=@./roles/ibm-concert-demo-content/templates/content/compliance/sample-compliance/posture_results.json"

  register: output_string
  ignore_errors: true
  args:
    executable: /bin/bash

- name: üü£  OUTPUT
  debug: 
    var: output_string.stdout_lines
    #verbosity: 1




- name:   üöÄ IBM Concert - Demo Content Certificate
  shell: |
    set -x


    echo ""
    echo ""
    echo ""
    echo ""
    echo "------------------------------------------------------------------------------------------------------------------------------"
    echo " üöÄ Set Variables"
    echo "------------------------------------------------------------------------------------------------------------------------------"
    export CONCERT_NAMESPACE=ibm-concert
    echo "       üõ†Ô∏è   Get Route"
    export ROUTE=$(oc get route -n $CONCERT_NAMESPACE cp-console  -o jsonpath={.spec.host})          
    echo "        Route: $ROUTE"
    echo ""
    export USER_PWD={{current_admin_pass}}
    export USER_NAME=demo
    export ACCESS_TOKEN=$(curl -s -k -H "Content-Type: application/x-www-form-urlencoded;charset=UTF-8" -d "grant_type=password&username=$USER_NAME&password=$USER_PWD&scope=openid" https://$ROUTE/idprovider/v1/auth/identitytoken|jq -r '.access_token')
    echo "        CPADMIN_USER: $USER_NAME"
    echo "        CPADMIN_PWD:  $USER_PWD"
    echo "        ACCESS_TOKEN: $ACCESS_TOKEN"

 
    echo "       üõ†Ô∏è   Getting ZEN Token"
  
    ZEN_API_HOST=$(oc get route -n $CONCERT_NAMESPACE concert -o jsonpath='{.spec.host}')

    ZEN_LOGIN_RESPONSE=$(curl -k -X "GET" "https://$ZEN_API_HOST/v1/preauth/validateAuth" \
    -H 'username: demo' \
    -H "iam-token: $ACCESS_TOKEN")

    ZEN_LOGIN_MESSAGE=$(echo "${ZEN_LOGIN_RESPONSE}" | jq -r .message)
    echo $ZEN_LOGIN_MESSAGE

    ZEN_TOKEN=$(echo "${ZEN_LOGIN_RESPONSE}" | jq -r .accessToken)
    echo "${ZEN_TOKEN}"
    echo "Sucessfully logged in" 1>&2
    echo ""
    echo ""
    echo ""
    echo ""
    echo ""
    echo "------------------------------------------------------------------------------------------------------------------------------"
    echo " üöÄ Upload Prod Certificates"
    echo "------------------------------------------------------------------------------------------------------------------------------"
    curl -X "POST" -k "https://$ZEN_API_HOST/ibm/concert/ingestion/api/v1/upload_files" \
        -H 'accept: application/json' \
        -H 'InstanceID: 0000-0000-0000-0000' \
        -H "Authorization: Bearer $ZEN_TOKEN" \
        -H 'Content-Type: multipart/form-data' \
        -F "data_type=certificate" \
        -F 'metadata={"env_name": "prod"}' \
        -F "filename=@./roles/ibm-concert-demo-content/templates/content/certificates/certificates-demo.json"

  register: output_string
  ignore_errors: true
  args:
    executable: /bin/bash

- name: üü£  OUTPUT
  debug: 
    var: output_string.stdout_lines
    #verbosity: 1




# - name:   üöÄ IBM Concert - Demo Content RobotShop Build 123
#   shell: |
#     set -x


#     function upload_files {
#     curl -X "POST" -k "https://$ZEN_API_HOST/ibm/concert/ingestion/api/v1/upload_files" \
#         -H 'accept: application/json' \
#         -H 'InstanceID: 0000-0000-0000-0000' \
#         -H "Authorization: Bearer $ZEN_TOKEN" \
#         -H 'Content-Type: multipart/form-data' \
#         -F "data_type=$DATA_TYPE" \
#         -F "filename=@$DATA_PATH"
#     sleep 15
#     }

#     function upload_vulnerability {
#     curl -X "POST" -k "https://$ZEN_API_HOST/ibm/concert/ingestion/api/v1/upload_files" \
#         -H 'accept: application/json' \
#         -H 'InstanceID: 0000-0000-0000-0000' \
#         -H "Authorization: Bearer $ZEN_TOKEN" \
#         -H 'Content-Type: multipart/form-data' \
#         -F "data_type=image_scan" \
#         -F "scanner_name=prismacloud" \
#         -F $'Content-Disposition: form-data; name="metadata"\r\n\r\n{"scanner_name":"prismacloud"}' \
#         -F "filename=@$DATA_PATH"
#     sleep 15
#     }



#     echo ""
#     echo ""
#     echo ""
#     echo ""
#     echo "------------------------------------------------------------------------------------------------------------------------------"
#     echo " üöÄ Set Variables"
#     echo "------------------------------------------------------------------------------------------------------------------------------"
#     export CONCERT_NAMESPACE=ibm-concert
#     echo "       üõ†Ô∏è   Get Route"
#     export ROUTE=$(oc get route -n $CONCERT_NAMESPACE cp-console  -o jsonpath={.spec.host})          
#     echo "        Route: $ROUTE"
#     echo ""
#     export USER_PWD={{current_admin_pass}}
#     export USER_NAME=demo
#     export ACCESS_TOKEN=$(curl -s -k -H "Content-Type: application/x-www-form-urlencoded;charset=UTF-8" -d "grant_type=password&username=$USER_NAME&password=$USER_PWD&scope=openid" https://$ROUTE/idprovider/v1/auth/identitytoken|jq -r '.access_token')
#     echo "        CPADMIN_USER: $USER_NAME"
#     echo "        CPADMIN_PWD:  $USER_PWD"
#     echo "        ACCESS_TOKEN: $ACCESS_TOKEN"

 
#     echo "       üõ†Ô∏è   Getting ZEN Token"
  
#     ZEN_API_HOST=$(oc get route -n $CONCERT_NAMESPACE concert -o jsonpath='{.spec.host}')

#     ZEN_LOGIN_RESPONSE=$(curl -k -X "GET" "https://$ZEN_API_HOST/v1/preauth/validateAuth" \
#     -H 'username: demo' \
#     -H "iam-token: $ACCESS_TOKEN")

#     ZEN_LOGIN_MESSAGE=$(echo "${ZEN_LOGIN_RESPONSE}" | jq -r .message)
#     echo $ZEN_LOGIN_MESSAGE

#     ZEN_TOKEN=$(echo "${ZEN_LOGIN_RESPONSE}" | jq -r .accessToken)
#     echo "${ZEN_TOKEN}"
#     echo "Sucessfully logged in" 1>&2
#     echo ""
#     echo ""
#     echo ""
#     echo ""
#     echo ""
#     echo "------------------------------------------------------------------------------------------------------------------------------"
#     echo " üöÄ Upload RobotShop Application"
#     echo "------------------------------------------------------------------------------------------------------------------------------"
#     export DATA_TYPE=application_sbom
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_definition/RobotShop-app-definition-sbom.json"
#     upload_files




#     echo ""
#     echo ""
#     echo ""
#     echo ""
#     echo ""
#     echo "------------------------------------------------------------------------------------------------------------------------------"
#     echo " üöÄ Upload RobotShop Build 123"
#     echo "------------------------------------------------------------------------------------------------------------------------------"
#     export DATA_TYPE=application_sbom
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-cart-build-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-catalogue-build-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-dispatch-build-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-load-gen-build-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-mongo-build-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-mysql-build-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-payment-build-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-ratings-build-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-shipping-build-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-user-build-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-web-build-sbom.json"
#     upload_files

#     echo ""
#     echo ""
#     echo ""
#     echo ""
#     echo ""
#     echo "------------------------------------------------------------------------------------------------------------------------------"
#     echo " üöÄ Upload RobotShop Code Scan 123"
#     echo "------------------------------------------------------------------------------------------------------------------------------"
#     export DATA_TYPE=package_sbom
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-cart-codescan-cyclonedx-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-catalogue-codescan-cyclonedx-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-dispatch-codescan-cyclonedx-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-load-gen-codescan-cyclonedx-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-mongo-codescan-cyclonedx-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-mysql-codescan-cyclonedx-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-payment-codescan-cyclonedx-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-ratings-codescan-cyclonedx-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-shipping-codescan-cyclonedx-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-user-codescan-cyclonedx-sbom.json"
#     upload_files

#     echo ""
#     echo ""
#     echo ""
#     echo ""
#     echo ""
#     echo "------------------------------------------------------------------------------------------------------------------------------"
#     echo " üöÄ Upload RobotShop Container Scan 123"
#     echo "------------------------------------------------------------------------------------------------------------------------------"
#     export DATA_TYPE=package_sbom
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-cart-imagescan-cyclonedx-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-catalogue-imagescan-cyclonedx-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-dispatch-imagescan-cyclonedx-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-mongo-imagescan-cyclonedx-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-mysql-imagescan-cyclonedx-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-payment-imagescan-cyclonedx-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-ratings-imagescan-cyclonedx-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-shipping-imagescan-cyclonedx-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-user-imagescan-cyclonedx-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-web-imagescan-cyclonedx-sbom.json"
#     upload_files


#     echo ""
#     echo ""
#     echo ""
#     echo ""
#     echo ""
#     echo "------------------------------------------------------------------------------------------------------------------------------"
#     echo " üöÄ Upload RobotShop CSV Scan 123"
#     echo "------------------------------------------------------------------------------------------------------------------------------"
#     export DATA_TYPE=image_scan
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-cart-cve-scan.csv"
#     upload_vulnerability
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-catalogue-cve-scan.csv"
#     upload_vulnerability
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-dispatch-cve-scan.csv"
#     upload_vulnerability
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-load-gen-cve-scan.csv"
#     upload_vulnerability
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-mongo-cve-scan.csv"
#     upload_vulnerability
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-mysql-cve-scan.csv"
#     upload_vulnerability
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-payment-cve-scan.csv"
#     upload_vulnerability
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/123/RobotShop-shipping-cve-scan.csv"
#     upload_vulnerability


#     echo ""
#     echo ""
#     echo ""
#     echo ""
#     echo ""
#     echo "------------------------------------------------------------------------------------------------------------------------------"
#     echo " üöÄ Upload RobotShop Deploy 123"
#     echo "------------------------------------------------------------------------------------------------------------------------------"
#     export DATA_TYPE=application_sbom
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/123/RobotShop-cart-prod-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/123/RobotShop-cart-qa-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/123/RobotShop-catalogue-prod-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/123/RobotShop-catalogue-qa-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/123/RobotShop-dispatch-prod-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/123/RobotShop-dispatch-qa-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/123/RobotShop-load-gen-prod-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/123/RobotShop-load-gen-qa-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/123/RobotShop-mongo-prod-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/123/RobotShop-mongo-qa-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/123/RobotShop-mysql-prod-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/123/RobotShop-mysql-qa-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/123/RobotShop-payment-prod-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/123/RobotShop-payment-qa-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/123/RobotShop-ratings-prod-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/123/RobotShop-ratings-qa-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/123/RobotShop-shipping-prod-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/123/RobotShop-shipping-qa-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/123/RobotShop-user-prod-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/123/RobotShop-user-qa-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/123/RobotShop-web-prod-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/123/RobotShop-web-qa-deploy-sbom.json"
#     upload_files

#   register: output_string
#   ignore_errors: true
#   args:
#     executable: /bin/bash

# - name: üü£  OUTPUT
#   debug: 
#     var: output_string.stdout_lines
#     #verbosity: 1






# - name:   üöÄ IBM Concert - Demo Content RobotShop Build 125
#   shell: |
#     set -x



#     function upload_files {
#     curl -X "POST" -k "https://$ZEN_API_HOST/ibm/concert/ingestion/api/v1/upload_files" \
#         -H 'accept: application/json' \
#         -H 'InstanceID: 0000-0000-0000-0000' \
#         -H "Authorization: Bearer $ZEN_TOKEN" \
#         -H 'Content-Type: multipart/form-data' \
#         -F "data_type=$DATA_TYPE" \
#         -F "filename=@$DATA_PATH"
#     sleep 15
#     }

#     function upload_vulnerability {
#     curl -X "POST" -k "https://$ZEN_API_HOST/ibm/concert/ingestion/api/v1/upload_files" \
#         -H 'accept: application/json' \
#         -H 'InstanceID: 0000-0000-0000-0000' \
#         -H "Authorization: Bearer $ZEN_TOKEN" \
#         -H 'Content-Type: multipart/form-data' \
#         -F "data_type=image_scan" \
#         -F "scanner_name=prismacloud" \
#         -F $'Content-Disposition: form-data; name="metadata"\r\n\r\n{"scanner_name":"prismacloud"}' \
#         -F "filename=@$DATA_PATH"
#     sleep 15
#     }

#     echo ""
#     echo ""
#     echo ""
#     echo ""
#     echo "------------------------------------------------------------------------------------------------------------------------------"
#     echo " üöÄ Set Variables"
#     echo "------------------------------------------------------------------------------------------------------------------------------"
#     export CONCERT_NAMESPACE=ibm-concert
#     echo "       üõ†Ô∏è   Get Route"
#     export ROUTE=$(oc get route -n $CONCERT_NAMESPACE cp-console  -o jsonpath={.spec.host})          
#     echo "        Route: $ROUTE"
#     echo ""
#     export USER_PWD={{current_admin_pass}}
#     export USER_NAME=demo
#     export ACCESS_TOKEN=$(curl -s -k -H "Content-Type: application/x-www-form-urlencoded;charset=UTF-8" -d "grant_type=password&username=$USER_NAME&password=$USER_PWD&scope=openid" https://$ROUTE/idprovider/v1/auth/identitytoken|jq -r '.access_token')
#     echo "        CPADMIN_USER: $USER_NAME"
#     echo "        CPADMIN_PWD:  $USER_PWD"
#     echo "        ACCESS_TOKEN: $ACCESS_TOKEN"

 
#     echo "       üõ†Ô∏è   Getting ZEN Token"
  
#     ZEN_API_HOST=$(oc get route -n $CONCERT_NAMESPACE concert -o jsonpath='{.spec.host}')

#     ZEN_LOGIN_RESPONSE=$(curl -k -X "GET" "https://$ZEN_API_HOST/v1/preauth/validateAuth" \
#     -H 'username: demo' \
#     -H "iam-token: $ACCESS_TOKEN")

#     ZEN_LOGIN_MESSAGE=$(echo "${ZEN_LOGIN_RESPONSE}" | jq -r .message)
#     echo $ZEN_LOGIN_MESSAGE

#     ZEN_TOKEN=$(echo "${ZEN_LOGIN_RESPONSE}" | jq -r .accessToken)
#     echo "${ZEN_TOKEN}"
#     echo "Sucessfully logged in" 1>&2
#     echo ""
#     echo ""
#     echo ""
#     echo ""
#     echo ""
#     echo "------------------------------------------------------------------------------------------------------------------------------"
#     echo " üöÄ Upload RobotShop Application"
#     echo "------------------------------------------------------------------------------------------------------------------------------"
#     export DATA_TYPE=application_sbom
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_definition/RobotShop-app-definition-sbom.json"
#     upload_files




#     echo ""
#     echo ""
#     echo ""
#     echo ""
#     echo ""
#     echo "------------------------------------------------------------------------------------------------------------------------------"
#     echo " üöÄ Upload RobotShop Build 125"
#     echo "------------------------------------------------------------------------------------------------------------------------------"
#     export DATA_TYPE=application_sbom
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-cart-build-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-catalogue-build-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-dispatch-build-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-load-gen-build-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-mongo-build-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-mysql-build-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-payment-build-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-ratings-build-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-shipping-build-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-user-build-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-web-build-sbom.json"
#     upload_files

#     echo ""
#     echo ""
#     echo ""
#     echo ""
#     echo ""
#     echo "------------------------------------------------------------------------------------------------------------------------------"
#     echo " üöÄ Upload RobotShop Code Scan 125"
#     echo "------------------------------------------------------------------------------------------------------------------------------"
#     export DATA_TYPE=package_sbom
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-cart-codescan-cyclonedx-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-catalogue-codescan-cyclonedx-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-dispatch-codescan-cyclonedx-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-load-gen-codescan-cyclonedx-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-mongo-codescan-cyclonedx-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-mysql-codescan-cyclonedx-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-payment-codescan-cyclonedx-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-ratings-codescan-cyclonedx-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-shipping-codescan-cyclonedx-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-user-codescan-cyclonedx-sbom.json"
#     upload_files

#     echo ""
#     echo ""
#     echo ""
#     echo ""
#     echo ""
#     echo "------------------------------------------------------------------------------------------------------------------------------"
#     echo " üöÄ Upload RobotShop Container Scan 125"
#     echo "------------------------------------------------------------------------------------------------------------------------------"
#     export DATA_TYPE=package_sbom
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-cart-imagescan-cyclonedx-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-catalogue-imagescan-cyclonedx-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-dispatch-imagescan-cyclonedx-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-mongo-imagescan-cyclonedx-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-mysql-imagescan-cyclonedx-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-payment-imagescan-cyclonedx-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-ratings-imagescan-cyclonedx-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-shipping-imagescan-cyclonedx-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-user-imagescan-cyclonedx-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-web-imagescan-cyclonedx-sbom.json"
#     upload_files


#     echo ""
#     echo ""
#     echo ""
#     echo ""
#     echo ""
#     echo "------------------------------------------------------------------------------------------------------------------------------"
#     echo " üöÄ Upload RobotShop CSV Scan 125"
#     echo "------------------------------------------------------------------------------------------------------------------------------"
#     export DATA_TYPE=image_scan
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-cart-cve-scan.csv"
#     upload_vulnerability
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-catalogue-cve-scan.csv"
#     upload_vulnerability
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-dispatch-cve-scan.csv"
#     upload_vulnerability
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-load-gen-cve-scan.csv"
#     upload_vulnerability
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-mongo-cve-scan.csv"
#     upload_vulnerability
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-mysql-cve-scan.csv"
#     upload_vulnerability
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-payment-cve-scan.csv"
#     upload_vulnerability
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/build/125/RobotShop-shipping-cve-scan.csv"
#     upload_vulnerability


#     echo ""
#     echo ""
#     echo ""
#     echo ""
#     echo ""
#     echo "------------------------------------------------------------------------------------------------------------------------------"
#     echo " üöÄ Upload RobotShop Deploy 125"
#     echo "------------------------------------------------------------------------------------------------------------------------------"
#     export DATA_TYPE=application_sbom
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/125/RobotShop-cart-prod-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/125/RobotShop-cart-qa-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/125/RobotShop-catalogue-prod-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/125/RobotShop-catalogue-qa-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/125/RobotShop-dispatch-prod-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/125/RobotShop-dispatch-qa-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/125/RobotShop-load-gen-prod-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/125/RobotShop-load-gen-qa-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/125/RobotShop-mongo-prod-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/125/RobotShop-mongo-qa-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/125/RobotShop-mysql-prod-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/125/RobotShop-mysql-qa-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/125/RobotShop-payment-prod-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/125/RobotShop-payment-qa-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/125/RobotShop-ratings-prod-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/125/RobotShop-ratings-qa-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/125/RobotShop-shipping-prod-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/125/RobotShop-shipping-qa-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/125/RobotShop-user-prod-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/125/RobotShop-user-qa-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/125/RobotShop-web-prod-deploy-sbom.json"
#     upload_files
#     export DATA_PATH="./roles/ibm-concert-demo-content/templates/content/apps/robot-shop/application_360_data/deploy/125/RobotShop-web-qa-deploy-sbom.json"
#     upload_files

#   register: output_string
#   ignore_errors: true
#   args:
#     executable: /bin/bash

# - name: üü£  OUTPUT
#   debug: 
#     var: output_string.stdout_lines
#     #verbosity: 1







