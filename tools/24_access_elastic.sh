#!/bin/bash
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# ADAPT VALUES in ./01_config.sh
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# DO NOT EDIT BELOW
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

export AIOPS_NAMESPACE=$(oc get po -A|grep aiops-orchestrator-controller |awk '{print$1}')





echo "***************************************************************************************************************************************************"
echo "***************************************************************************************************************************************************"
echo " üöÄ AI OPS DEBUG - Enable ElastcSearch remote access"
echo "***************************************************************************************************************************************************"

echo "  Initializing......"







#--------------------------------------------------------------------------------------------------------------------------------------------
#  Get Credentials
#--------------------------------------------------------------------------------------------------------------------------------------------

echo "***************************************************************************************************************************************************"
echo "  üîê  Getting credentials"
echo "***************************************************************************************************************************************************"
oc project $AIOPS_NAMESPACE

export username=elastic
export password=$(oc get secret $(oc get secrets | grep aiops-ibm-elasticsearch-creds | awk '!/-min/' | awk '{print $1;}') -o jsonpath="{.data.elastic}"| base64 --decode)	
#echo $username:$password




echo "      ‚úÖ OK"
echo ""
echo ""





#--------------------------------------------------------------------------------------------------------------------------------------------
#  Check Credentials
#--------------------------------------------------------------------------------------------------------------------------------------------

echo "***************************************************************************************************************************************************"
echo "  üîó  Checking credentials"
echo "***************************************************************************************************************************************************"

if [[ $username == "" ]] ;
then
      echo "‚ùå Could not get Elasticsearch Username. Aborting..."
      exit 1
else
      echo "      ‚úÖ OK - Elasticsearch Username"
fi

if [[ $password == "" ]] ;
then
      echo "‚ùå Could not get Elasticsearch Password. Aborting..."
      exit 1
else
      echo "      ‚úÖ OK - Elasticsearch Password"
fi



echo ""
echo ""
echo ""
echo ""





echo "***************************************************************************************************************************************************"
echo "  üîó  ElasticSearch Access"
echo "***************************************************************************************************************************************************"
echo ""
echo "           üåè URL                         : https://localhost:9200"
echo ""
echo "           üôé‚Äç‚ôÇÔ∏è User                        : $username"
echo "           üîê Password                    : $password"
echo ""
echo "            You can use any ElasticSearch Browser. I usually use https://elasticvue.com/"
echo ""
echo "***************************************************************************************************************************************************"
echo ""
echo ""
echo "***************************************************************************************************************************************************"
echo "  ‚ñ∂Ô∏è  Starting Port Forwarding"
echo "***************************************************************************************************************************************************"
echo ""

while true; do oc port-forward statefulset/aiops-ibm-elasticsearch-es-server-all 9200; done




